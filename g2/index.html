<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Car Simulator 2</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#000000">

<style>
body{margin:0;overflow:hidden;background:#000;font-family:Arial}
#ui{
 position:fixed;bottom:10px;left:50%;
 transform:translateX(-50%);
 display:flex;flex-wrap:wrap;gap:8px;z-index:10
}
button{
 min-width:48px;min-height:48px;
 border:none;border-radius:8px;
 background:#222;color:#fff;font-size:14px
}
#info{
 position:fixed;top:8px;left:8px;
 color:#fff;font-size:12px;z-index:10
}
</style>
</head>

<body>

<div id="info">
ðŸ’° Unlimited | ðŸ’ª Max Fitness | ðŸš— Cars | ðŸ”¥ Drift | ðŸš“ Traffic
</div>

<div id="ui">
<button ontouchstart="gas=1" ontouchend="gas=0">â–²</button>
<button ontouchstart="brake=1" ontouchend="brake=0">â–¼</button>
<button ontouchstart="left=1" ontouchend="left=0">â—€</button>
<button ontouchstart="right=1" ontouchend="right=0">â–¶</button>
<button onclick="switchCar()">CAR</button>
<button onclick="randomColor()">COLOR</button>
<button onclick="toggleDrift()">DRIFT</button>
<button onclick="nitro()">NITRO</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>

<script>
/* ============ RENDERER (FAST + SCALE SAFE) ============ */
const renderer=new THREE.WebGLRenderer({antialias:false,powerPreference:"high-performance"});
document.body.appendChild(renderer.domElement);

/* ============ SCENE & CAMERA ============ */
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x87ceeb);
const camera=new THREE.PerspectiveCamera(70,1,0.1,2000);

/* ============ LIGHT ============ */
scene.add(new THREE.AmbientLight(0xffffff,0.6));
const sun=new THREE.DirectionalLight(0xffffff,1);
sun.position.set(200,300,100);
scene.add(sun);

/* ============ WORLD ============ */
const ground=new THREE.Mesh(
 new THREE.PlaneGeometry(2000,2000),
 new THREE.MeshStandardMaterial({color:0x444444})
);
ground.rotation.x=-Math.PI/2;
scene.add(ground);

/* ============ CARS ============ */
let cars=[];
function createCar(color){
 const car=new THREE.Mesh(
  new THREE.BoxGeometry(4,1.8,2),
  new THREE.MeshStandardMaterial({color})
 );
 car.position.y=1;
 car.userData={
  v:0,
  max:1.3,
  accel:0.03,
  brake:0.06,
  friction:0.985,
  steer:0,
  steerLim:0.04,
  grip:0.95
 };
 scene.add(car);
 cars.push(car);
}
createCar(0xff0000);
createCar(0x00ff00);
createCar(0x0000ff);

cars.forEach(c=>c.visible=false);
let currentCar=0;
cars[0].visible=true;

/* ============ TRAFFIC (SIMPLE) ============ */
let traffic=[];
for(let i=0;i<10;i++){
 const t=new THREE.Mesh(
  new THREE.BoxGeometry(3,1.5,2),
  new THREE.MeshStandardMaterial({color:0x999999})
 );
 t.position.set(Math.random()*600-300,1,Math.random()*600-300);
 t.userData.speed=Math.random()*0.3+0.1;
 scene.add(t);
 traffic.push(t);
}

/* ============ INPUT ============ */
let gas=0,brake=0,left=0,right=0;
let drift=false;

/* ============ CAMERA START ============ */
camera.position.set(0,6,10);

/* ============ FUNCTIONS ============ */
function switchCar(){
 cars[currentCar].visible=false;
 currentCar=(currentCar+1)%cars.length;
 cars[currentCar].visible=true;
}
function randomColor(){
 cars[currentCar].material.color.set(Math.random()*0xffffff);
}
function nitro(){
 cars[currentCar].userData.v+=0.5;
}
function toggleDrift(){
 drift=!drift;
}

/* ============ MAIN LOOP (PHYSICS) ============ */
function animate(){
 requestAnimationFrame(animate);

 const car=cars[currentCar];
 const p=car.userData;

 // acceleration
 if(gas)   p.v+=p.accel*(1-p.v/p.max);
 if(brake) p.v-=p.brake;

 // friction
 p.v*=p.friction;
 p.v=Math.max(-0.6,Math.min(p.v,p.max));

 // steering
 if(left)  p.steer+=p.steerLim;
 if(right) p.steer-=p.steerLim;

 let grip=drift?0.75:p.grip;
 p.steer*=grip;

 // move
 car.rotation.y+=p.steer*Math.abs(p.v);
 car.position.x+=Math.sin(car.rotation.y)*p.v;
 car.position.z+=Math.cos(car.rotation.y)*p.v;

 // camera
 camera.position.lerp(
  new THREE.Vector3(car.position.x,car.position.y+6,car.position.z+10),
  0.1
 );
 camera.lookAt(car.position);

 // traffic move
 traffic.forEach(t=>{
  t.position.z+=t.userData.speed;
  if(t.position.z>500) t.position.z=-500;
 });

 renderer.render(scene,camera);
}
animate();

/* ============ SCALE FIX ============ */
function resize(){
 const w=innerWidth,h=innerHeight;
 camera.aspect=w/h;
 camera.updateProjectionMatrix();
 renderer.setSize(w,h,false);
 renderer.setPixelRatio(Math.min(devicePixelRatio,1.5));
}
window.addEventListener("resize",resize);
resize();
</script>

</body>
</html>
